# 博客系统模块化架构说明

## 架构概览

```
┌─────────────────────────────────────────────────────────────┐
│                        main.go                               │
│                     (程序入口)                               │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────┐
│                    handlers/                                │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   handlers.go    │  │    routes.go     │                  │
│  │  (业务逻辑处理)   │  │   (路由配置)     │                  │
│  └─────────────────┘  └─────────────────┘                  │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────┐
│                   middleware/                               │
│  ┌─────────────────┐                                        │
│  │   common.go      │                                        │
│  │  (通用中间件)     │                                        │
│  └─────────────────┘                                        │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────┐
│                     auth/                                    │
│  ┌─────────────────┐                                        │
│  │     jwt.go       │                                        │
│  │  (JWT认证)       │                                        │
│  └─────────────────┘                                        │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────┐
│                    models/                                  │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   structs.go     │  │     crud.go      │                  │
│  │  (数据结构)      │  │  (CRUD操作)     │                  │
│  └─────────────────┘  └─────────────────┘                  │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────┐
│                   database/                                  │
│  ┌─────────────────┐                                        │
│  │     init.go      │                                        │
│  │  (数据库连接)     │                                        │
│  └─────────────────┘                                        │
└─────────────────────────────────────────────────────────────┘
```

## 模块职责

### 1. main.go - 程序入口
- 初始化数据库连接
- 执行数据库迁移
- 启动HTTP服务器
- 协调各个模块

### 2. handlers/ - 处理器模块
- **handlers.go**: 处理HTTP请求，调用业务逻辑
- **routes.go**: 配置路由和中间件绑定
- 负责请求响应转换和错误处理

### 3. middleware/ - 中间件模块
- **common.go**: 提供CORS、日志、恢复等通用中间件
- 处理横切关注点
- 可复用的中间件组件

### 4. auth/ - 认证模块
- **jwt.go**: JWT令牌的生成、解析和验证
- 提供认证中间件
- 用户信息提取功能

### 5. models/ - 数据模型模块
- **structs.go**: 定义数据结构(User、Post、Comment)
- **crud.go**: 实现CRUD操作
- 封装数据访问层

### 6. database/ - 数据库模块
- **init.go**: 数据库连接初始化
- 提供全局数据库实例
- 数据库生命周期管理

## 数据流向

```
HTTP请求 → handlers → auth(认证) → models → database → SQLite
    ↓
HTTP响应 ← handlers ← models ← database ← SQLite
```

## 模块间依赖关系

- **main.go** 依赖: database, handlers, models
- **handlers** 依赖: auth, middleware, models
- **auth** 依赖: 无外部依赖
- **models** 依赖: database
- **middleware** 依赖: 无外部依赖
- **database** 依赖: 无外部依赖

## 设计原则

1. **单一职责**: 每个模块只负责一个特定功能
2. **依赖倒置**: 高层模块不依赖低层模块的具体实现
3. **接口隔离**: 模块间通过明确的接口进行交互
4. **开闭原则**: 对扩展开放，对修改封闭
5. **低耦合高内聚**: 模块内部紧密相关，模块间松散耦合
