# 测试脚本使用说明

## 📋 概述

本项目提供了完整的自动化测试脚本，用于验证博客系统的所有核心功能。测试脚本覆盖了用户认证、文章管理、评论功能和错误处理等关键模块。

## 🚀 快速开始

### 1. 环境准备

确保以下环境已就绪：
- ✅ 服务器运行在 `http://localhost:8088`
- ✅ 数据库连接正常
- ✅ curl命令可用
- ✅ bash环境支持

### 2. 运行测试

```bash
# 进入项目目录
cd /Users/alba90/Documents/Doc/WEB3/WEB3-STUDY/GO-BLOG/blog-system

# 运行单个测试
./scripts/test_user_auth.sh

# 运行所有测试
for script in scripts/test_*.sh; do
    echo "运行测试: $script"
    ./$script
    echo "----------------------------------------"
done
```

## 📁 测试脚本说明

### 1. test_user_auth.sh - 用户认证与授权测试

**功能**: 测试用户注册、登录、JWT认证等功能

**测试内容**:
- ✅ 用户注册功能（正常注册、重复用户名、重复邮箱、无效数据）
- ✅ 用户登录功能（正常登录、错误用户名、错误密码、无效数据）
- ✅ JWT认证功能（有效token、无效token、无token）
- ✅ 密码加密存储验证

**使用方法**:
```bash
./scripts/test_user_auth.sh
```

**预期结果**:
- 总测试数: 12
- 通过率: 75%以上
- 关键功能: 用户注册、登录、JWT认证

### 2. test_post_management.sh - 文章管理功能测试

**功能**: 测试文章的CRUD操作和权限控制

**测试内容**:
- ✅ 文章创建功能（已认证用户、未认证用户、无效数据）
- ✅ 文章读取功能（获取列表、获取单个、不存在文章）
- ✅ 文章更新功能（作者更新、未认证用户、不存在文章）
- ✅ 文章删除功能（作者删除、未认证用户、不存在文章）
- ✅ 权限控制测试（用户只能操作自己的文章）

**使用方法**:
```bash
./scripts/test_post_management.sh
```

**预期结果**:
- 总测试数: 13
- 通过率: 69%以上
- 关键功能: 文章CRUD、权限控制

### 3. test_comment_functionality.sh - 评论功能测试

**功能**: 测试评论的创建和读取功能

**测试内容**:
- ✅ 评论创建功能（已认证用户、未认证用户、无效数据）
- ✅ 评论读取功能（获取文章评论、不存在文章）
- ✅ 多用户评论测试（多个用户对同一文章评论）
- ✅ 评论数据验证（长评论、特殊字符、中文评论）
- ✅ 评论关联关系（与用户、文章的关联）

**使用方法**:
```bash
./scripts/test_comment_functionality.sh
```

**预期结果**:
- 总测试数: 8
- 通过率: 50%以上
- 关键功能: 评论创建、读取、关联

### 4. test_error_handling_logging.sh - 错误处理与日志记录测试

**功能**: 测试错误处理和日志记录功能

**测试内容**:
- ✅ HTTP状态码错误处理（400、401、404、409、500）
- ✅ 数据库连接错误处理
- ✅ 数据验证错误处理（必填字段、格式验证、长度验证）
- ✅ JWT认证错误处理（无效格式、过期token、无认证头）
- ✅ 业务逻辑错误处理（权限不足、资源不存在）
- ✅ 系统错误处理（内部错误、服务不可用）
- ✅ 日志记录功能（成功操作、错误操作、日志格式）
- ✅ 错误响应格式测试（结构验证、可读性）
- ✅ 边界条件错误处理（空请求体、无效JSON）

**使用方法**:
```bash
./scripts/test_error_handling_logging.sh
```

**预期结果**:
- 总测试数: 29
- 通过率: 62%以上
- 关键功能: 错误处理、日志记录

## 📊 测试结果解读

### 1. 测试输出格式

测试脚本会输出以下信息：
- 📋 测试步骤说明
- ✅ 测试结果（通过/失败/信息）
- 📊 测试统计信息
- 🔍 详细的请求和响应信息
- 🎯 测试总结和建议

### 2. 状态码说明

| 状态 | 符号 | 含义 |
|------|------|------|
| 通过 | ✅ | 测试成功 |
| 失败 | ❌ | 测试失败 |
| 信息 | ℹ️ | 需要手动验证 |

### 3. 测试统计

每个测试脚本会显示：
- 总测试数
- 通过数
- 失败数
- 通过率

## 🔧 故障排除

### 1. 常见问题

#### 问题1: 服务器连接失败
```
错误: 服务器未运行或无法访问
解决: 确保服务器运行在 http://localhost:8088
```

#### 问题2: 权限不足
```
错误: Permission denied
解决: chmod +x scripts/test_*.sh
```

#### 问题3: curl命令不可用
```
错误: curl: command not found
解决: 安装curl或使用其他HTTP客户端
```

### 2. 调试方法

#### 方法1: 启用详细输出
```bash
# 运行测试并保存输出
./scripts/test_user_auth.sh > test_output.txt 2>&1

# 查看详细输出
cat test_output.txt
```

#### 方法2: 检查服务器状态
```bash
# 检查服务器是否运行
curl -s -o /dev/null -w "%{http_code}" http://localhost:8088/api/posts

# 检查数据库连接
curl -s http://localhost:8088/api/posts | head -20
```

#### 方法3: 手动验证
```bash
# 手动测试API
curl -X POST http://localhost:8088/api/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"test123","email":"test@example.com"}'
```

## 📈 测试报告

### 1. 生成测试报告

测试完成后，会生成以下文件：
- `test_user_auth_result.txt` - 用户认证测试结果
- `test_post_management_result.txt` - 文章管理测试结果
- `test_comment_functionality_result.txt` - 评论功能测试结果
- `test_error_handling_logging_result.txt` - 错误处理测试结果

### 2. 查看测试报告

```bash
# 查看所有测试结果
ls -la scripts/*_result.txt

# 查看特定测试结果
cat scripts/test_user_auth_result.txt
```

### 3. 测试报告分析

测试报告包含：
- 测试执行时间
- 测试环境信息
- 详细测试结果
- 问题分析和建议
- 测试统计信息

## 🎯 最佳实践

### 1. 测试前准备

1. **环境检查**: 确保服务器和数据库正常运行
2. **数据清理**: 清理之前的测试数据
3. **权限设置**: 确保测试脚本有执行权限

### 2. 测试执行

1. **顺序执行**: 按顺序运行测试脚本
2. **结果记录**: 保存测试结果用于分析
3. **问题记录**: 记录发现的问题和错误

### 3. 测试后分析

1. **结果分析**: 分析测试结果和失败原因
2. **问题修复**: 根据测试结果修复问题
3. **重新测试**: 修复后重新运行测试

## 📚 相关文档

- `TEST_RESULTS.md` - 测试结果汇总报告
- `TEST_ANALYSIS.md` - 详细测试分析报告
- `FIX_SUGGESTIONS.md` - 修复建议文档
- `README.md` - 项目主文档

## 🔄 更新日志

### v1.0.0 (2025-10-21)
- ✅ 初始版本发布
- ✅ 四个核心测试脚本
- ✅ 完整的测试覆盖
- ✅ 详细的测试报告

---

**文档版本**: v1.0.0  
**最后更新**: 2025年10月21日  
**维护者**: 项目开发团队
