[0;35m========================================[0m
[0;35m评论功能测试[0m
[0;35m========================================[0m
测试时间: Tue Oct 21 18:44:17 CST 2025
测试URL: http://localhost:8088/api
测试用户: commenttest_1761043457

[1;33m设置测试环境...[0m
注册响应: {"code":201,"message":"用户注册成功","data":{"email":"commenttest_1761043457@example.com","user_id":9,"username":"commenttest_1761043457"}}
登录响应: {"code":200,"message":"登录成功","data":{"email":"commenttest_1761043457@example.com","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo5LCJ1c2VybmFtZSI6ImNvbW1lbnR0ZXN0XzE3NjEwNDM0NTciLCJleHAiOjE3NjExMjk4NTcsImlhdCI6MTc2MTA0MzQ1N30.61UHX5C_i6_amvUBWFUF1eaQJUdL5QOfCcmKiMpyswU","user_id":9,"username":"commenttest_1761043457"}}
[0;32m✓ 用户设置成功，获取到JWT token[0m
JWT Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkI...
[1;33m创建测试文章...[0m
head: illegal line count -- -1
创建文章响应: 
[0;32m✓ 测试文章创建成功，文章ID: [0m

[0;34m=== 步骤 1: 评论创建功能测试 ===[0m
[1;33m执行测试: 已认证用户创建评论[0m
head: illegal line count -- -1
响应状态码: 400
响应内容: 
[0;31m✗ 已认证用户创建评论: 失败[0m
[0;36m详情: 状态码: 400[0m

[1;33m执行测试: 未认证用户创建评论[0m
请求: POST /posts//comments
head: illegal line count -- -1
响应状态码: 401
响应内容: 
[0;32m✓ 未认证用户创建评论: 通过[0m
[0;36m详情: 状态码匹配: 401[0m

[1;33m执行测试: 无效数据创建评论[0m
请求: POST /posts//comments
head: illegal line count -- -1
响应状态码: 400
响应内容: 
[0;32m✓ 无效数据创建评论: 通过[0m
[0;36m详情: 状态码匹配: 400[0m

[1;33m执行测试: 缺少内容字段创建评论[0m
请求: POST /posts//comments
head: illegal line count -- -1
响应状态码: 400
响应内容: 
[0;32m✓ 缺少内容字段创建评论: 通过[0m
[0;36m详情: 状态码匹配: 400[0m

[1;33m执行测试: 对不存在的文章创建评论[0m
请求: POST /posts/99999/comments
head: illegal line count -- -1
响应状态码: 404
响应内容: 
[0;32m✓ 对不存在的文章创建评论: 通过[0m
[0;36m详情: 状态码匹配: 404[0m


[0;34m=== 步骤 2: 评论读取功能测试 ===[0m
[1;33m执行测试: 获取文章的所有评论列表[0m
请求: GET /posts//comments
head: illegal line count -- -1
响应状态码: 400
响应内容: 
[0;31m✗ 获取文章的所有评论列表: 失败[0m
[0;36m详情: 期望状态码: 200, 实际状态码: 400[0m

[1;33m执行测试: 获取不存在文章的评论列表[0m
请求: GET /posts/99999/comments
head: illegal line count -- -1
响应状态码: 200
响应内容: 
[0;31m✗ 获取不存在文章的评论列表: 失败[0m
[0;36m详情: 期望状态码: 404, 实际状态码: 200[0m

[0;36mℹ 验证评论内容: 信息[0m
[0;36m详情: 跳过测试，因为未创建评论[0m


[0;34m=== 步骤 3: 多用户评论测试 ===[0m
[1;33m创建第二个用户进行多用户评论测试...[0m
第二个用户注册响应: {"code":201,"message":"用户注册成功","data":{"email":"commenttest2_1761043458@example.com","user_id":10,"username":"commenttest2_1761043458"}}
第二个用户登录响应: {"code":200,"message":"登录成功","data":{"email":"commenttest2_1761043458@example.com","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMCwidXNlcm5hbWUiOiJjb21tZW50dGVzdDJfMTc2MTA0MzQ1OCIsImV4cCI6MTc2MTEyOTg1OCwiaWF0IjoxNzYxMDQzNDU4fQ.q6RQ8nZxMiVpYSaj5v9OK1iB1BQ3s20Rwj7oLJol3u0","user_id":10,"username":"commenttest2_1761043458"}}
[0;32m✓ 第二个用户设置成功[0m
[1;33m第二个用户创建评论...[0m
head: illegal line count -- -1
第二个用户创建评论响应: 
[0;31m✗ 第二个用户创建评论: 失败[0m
[0;36m详情: 状态码: 400[0m


[0;34m=== 步骤 4: 评论数据验证测试 ===[0m
[1;33m执行测试: 长评论测试[0m
head: illegal line count -- -1
长评论响应状态码: 400
长评论响应内容: 
[0;31m✗ 长评论测试: 失败[0m
[0;36m详情: 状态码: 400[0m

[1;33m执行测试: 特殊字符评论测试[0m
./scripts/test_comment_functionality.sh: line 390: unexpected EOF while looking for matching ``'
./scripts/test_comment_functionality.sh: line 509: syntax error: unexpected end of file
