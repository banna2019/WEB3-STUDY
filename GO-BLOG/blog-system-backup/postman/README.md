# Postman API测试文档

## 📋 项目概述

本文档介绍如何使用Postman工具测试博客系统的API接口。Postman是一款专业的API测试工具，支持接口测试、文档生成、团队协作等功能。

## 🚀 快速开始

### 1. 安装Postman

- 访问 [Postman官网](https://www.postman.com/) 下载最新版本
- 支持Windows、macOS、Linux平台
- 提供Web版本和桌面版本

### 2. 导入项目

#### 方法一：导入集合文件
1. 打开Postman
2. 点击"Import"按钮
3. 选择 `collections/blog-system-api.json` 文件
4. 确认导入

#### 方法二：导入环境变量
1. 在Postman中点击右上角的"Environments"
2. 点击"Import"按钮
3. 选择 `environments/blog-system-environment.json` 文件
4. 确认导入

### 3. 配置环境

1. 在Postman右上角选择"博客系统环境"
2. 确认以下环境变量已正确设置：
- `base_url`: http://localhost:8088
   - `test_username`: testuser
   - `test_email`: test@example.com
   - `test_password`: password123

## 🚨 重要提醒：全JWT认证机制

### ⚠️ 关键点
1. **全接口认证**: 除了用户注册和登录外，**所有其他API接口都需要JWT认证**
2. **用户注册**: 用户信息保存到环境变量中，用于显示和调试
3. **用户登录**: 登录成功后，用户名和JWT token自动保存到全局变量`register_username`和`jwt_token`
4. **自动更新**: 每次新用户登录后，全局变量`register_username`和`jwt_token`都会自动更新为最新值
5. **统一使用**: 后续所有需要认证的操作都直接调用全局变量中的`register_username`和`jwt_token`
6. **测试流程顺序**: 必须先注册，再登录，然后才能访问需要认证的接口

### 🔄 正确的测试流程
```
注册用户 → 保存到环境变量 → 登录用户 → 更新全局变量register_username和jwt_token → 使用全局变量访问受保护接口
```

### 📝 变量说明

#### 环境变量（用于显示和调试）
- **`registered_username`**: 注册时的用户名（环境变量中显示）
- **`registered_email`**: 注册时的邮箱（环境变量中显示）
- **`user_id`**: 用户ID（环境变量中显示）
- **`jwt_token`**: JWT令牌（环境变量中显示）

#### 全局变量（用于后续操作）
- **`register_username`**: 最新登录的用户名（全局变量，用于后续操作）
- **`jwt_token`**: 最新登录的JWT令牌（全局变量，用于后续操作）
- **`global_username`**: 动态生成的用户名（注册时临时使用）
- **`global_password`**: 动态生成的密码（注册时临时使用）

### 🔍 register_username和jwt_token的来源
- **`register_username`**: 来自用户登录接口返回的`username`字段
- **`jwt_token`**: 来自用户登录接口返回的`token`字段
- **更新时机**: 每次执行用户登录接口成功后，这两个全局变量都会自动更新
- **使用范围**: **所有需要认证的接口**（获取文章列表、获取单个文章、创建文章、更新文章、删除文章、获取评论、创建评论、更新评论、删除评论等）都使用这两个全局变量

### ❌ 常见错误
- 注册时使用 `testuser`，登录时使用 `testuser2`
- 注册时密码是 `password123`，登录时密码是 `password456`
- 跳过注册直接尝试登录

### ✅ 正确做法
- 注册和登录使用完全相同的用户名和密码
- 按照文档中的测试流程顺序执行
- 查看控制台输出确认每个步骤的成功状态

## 📚 API接口说明

### 🔐 用户认证模块

#### 1. 用户注册
- **接口**: `POST {{base_url}}/api/register`
- **描述**: 注册新用户
- **请求体**:
  ```json
  {
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123"
  }
  ```
- **响应**: 返回用户信息和用户ID
- **测试脚本**: 自动保存用户ID到环境变量

#### 2. 用户登录
- **接口**: `POST {{base_url}}/api/login`
- **描述**: 用户登录获取JWT令牌
- **请求体**:
  ```json
  {
    "username": "testuser",
    "password": "password123"
  }
  ```
- **响应**: 返回JWT令牌和用户信息
- **测试脚本**: 自动保存JWT令牌到环境变量

### 📝 文章管理模块

#### 1. 获取所有文章
- **接口**: `GET {{base_url}}/api/posts`
- **描述**: 获取所有公开文章列表
- **认证**: **需要JWT令牌**
- **请求头**: `Authorization: Bearer {token}`

#### 2. 获取单个文章
- **接口**: `GET {{base_url}}/api/posts/{id}`
- **描述**: 根据ID获取文章详情
- **认证**: **需要JWT令牌**
- **请求头**: `Authorization: Bearer {token}`

#### 3. 获取最后一篇文章
- **接口**: `GET {{base_url}}/api/latest-post`
- **描述**: 获取数据库中最后一篇文章
- **认证**: **需要JWT令牌**
- **请求头**: `Authorization: Bearer {token}`

#### 4. 创建文章
- **接口**: `POST {{base_url}}/api/posts`
- **描述**: 创建新文章
- **认证**: 需要JWT令牌
- **请求头**: `Authorization: Bearer {token}`
- **请求体**:
  ```json
  {
    "title": "文章标题",
    "content": "文章内容",
    "summary": "文章摘要"
  }
  ```
- **测试脚本**: 自动保存文章ID到环境变量

#### 5. 更新文章
- **接口**: `PUT {{base_url}}/api/posts/{id}`
- **描述**: 更新指定文章
- **认证**: 需要JWT令牌（仅作者可操作）

#### 6. 删除文章
- **接口**: `DELETE {{base_url}}/api/posts/{id}`
- **描述**: 删除指定文章
- **认证**: 需要JWT令牌（仅作者可操作）

### 💬 评论功能模块

#### 1. 获取文章评论
- **接口**: `GET {{base_url}}/api/posts/{id}/comments`
- **描述**: 获取指定文章的所有评论
- **认证**: **需要JWT令牌**
- **请求头**: `Authorization: Bearer {token}`

#### 2. 获取单个评论
- **接口**: `GET {{base_url}}/api/comments/{id}`
- **描述**: 根据ID获取评论详情
- **认证**: **需要JWT令牌**
- **请求头**: `Authorization: Bearer {token}`

#### 3. 创建评论
- **接口**: `POST {{base_url}}/api/posts/{id}/comments`
- **描述**: 为指定文章创建评论
- **认证**: 需要JWT令牌
- **请求体**:
  ```json
  {
    "content": "评论内容"
  }
  ```
- **测试脚本**: 自动保存评论ID到环境变量

#### 4. 更新评论
- **接口**: `PUT {{base_url}}/api/comments/{id}`
- **描述**: 更新指定评论
- **认证**: 需要JWT令牌（仅作者可操作）

#### 5. 删除评论
- **接口**: `DELETE {{base_url}}/api/comments/{id}`
- **描述**: 删除指定评论
- **认证**: 需要JWT令牌（仅作者可操作）

## 🧪 测试流程

### 完整测试流程

1. **用户注册** → 获取用户ID
2. **用户登录** → 获取JWT令牌
3. **获取文章列表** → 验证认证成功
4. **创建文章** → 获取文章ID
5. **获取文章详情** → 验证认证成功
6. **创建评论** → 获取评论ID
7. **获取评论列表** → 验证认证成功
8. **测试各种操作** → 验证功能

### 错误处理测试

- **重复用户注册**: 测试409状态码
- **无效登录**: 测试401状态码
- **无认证操作**: 测试401状态码（所有接口都需要认证）
- **访问不存在的资源**: 测试404状态码
- **权限不足**: 测试403状态码

## 🔧 环境变量说明

| 变量名 | 默认值 | 描述 | 变量类型 |
|--------|--------|------|----------|
| `base_url` | http://localhost:8088 | API基础URL | 环境变量 |
| `test_username` | testuser | 测试用户名 | 环境变量 |
| `test_email` | test@example.com | 测试邮箱 | 环境变量 |
| `test_password` | password123 | 测试密码 | 环境变量 |
| `jwt_token` | (动态) | JWT认证令牌（所有接口都需要） | 环境变量 |
| `user_id` | (动态) | 用户ID | 环境变量 |
| `post_id` | 1 | 文章ID | 环境变量 |
| `comment_id` | 1 | 评论ID | 环境变量 |
| `registered_username` | (动态) | 注册时的用户名（自动设置） | 环境变量 |
| `registered_email` | (动态) | 注册时的邮箱（自动设置） | 环境变量 |
| `logged_in_username` | (动态) | 登录时的用户名（自动设置） | 环境变量 |
| `dynamic_username` | (动态) | 动态生成的用户名（自动设置） | 环境变量 |
| `dynamic_email` | (动态) | 动态生成的邮箱（自动设置） | 环境变量 |
| `register_username` | (动态) | 最新登录的用户名（全局变量） | 全局变量 |
| `jwt_token` | (动态) | 最新登录的JWT令牌（全局变量） | 全局变量 |

## 📊 测试脚本功能

### 自动变量管理
- 登录成功后自动保存JWT令牌
- 注册/登录成功后自动保存用户ID
- 创建文章成功后自动保存文章ID
- 创建评论成功后自动保存评论ID
- **所有接口自动处理401认证失败**

### 响应验证
- 检查HTTP状态码
- 验证响应数据结构
- 记录测试结果到控制台

## 🚨 注意事项

1. **服务器启动**: 确保博客系统服务器已启动在8088端口
2. **数据库连接**: 确保MySQL数据库正常运行
3. **环境变量**: 测试前检查环境变量是否正确设置
4. **JWT令牌**: 令牌有时效性，过期后需要重新登录
5. **测试顺序**: 建议按照文档中的测试流程顺序执行
6. **全接口认证**: 除了注册和登录外，所有接口都需要JWT认证
7. **认证失败**: 如果返回401状态码，请先执行登录接口获取JWT令牌

## 📈 高级功能

### 1. 批量测试
- 使用Postman的"Collection Runner"功能
- 可以设置测试顺序和依赖关系
- 支持测试报告生成

### 2. 接口文档生成
- Postman可以自动生成API文档
- 支持多种文档格式导出
- 可以分享给团队成员

### 3. 团队协作
- 支持团队共享接口集合
- 可以设置权限管理
- 支持版本控制

## 🔍 故障排除

### 常见问题

1. **连接失败**
   - 检查服务器是否启动
   - 确认端口号是否正确
   - 检查防火墙设置

2. **认证失败**
   - 检查JWT令牌是否有效
   - 确认令牌格式是否正确
   - 重新登录获取新令牌
   - **确认所有接口都需要认证**

3. **环境变量未生效**
   - 确认已选择正确的环境
   - 检查变量名是否正确
   - 重新导入环境配置

## 📞 技术支持

如果在使用过程中遇到问题，可以：

1. 查看Postman官方文档
2. 访问Postman社区论坛
3. 联系技术支持团队

---

**最后更新**: 2024年10月22日  
**版本**: 2.0.0  
**更新内容**: 全JWT认证支持  
**作者**: 博客系统开发团队
