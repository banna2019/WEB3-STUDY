# Postman测试示例

## 📋 测试流程示例

本文档提供完整的Postman测试流程示例，帮助您快速上手API测试。

## 🚨 重要提醒：全局变量机制

### ⚠️ 关键点
1. **随机用户名和密码生成**: 每次注册都会自动生成唯一的用户名和密码
2. **全局环境变量**: 用户名和密码会保存到Postman的全局变量中，可在所有环境中使用
3. **自动关联**: 登录时自动使用注册时生成的用户名和密码
4. **测试流程顺序**: 必须先注册，再登录，然后才能访问需要认证的接口

### 🔄 正确的测试流程
```
注册用户（自动生成用户名+密码） → 保存到全局变量 → 使用全局变量登录 → 获取JWT令牌 → 访问受保护接口
```

### ❌ 常见错误
- 手动修改用户名或密码导致注册和登录不一致
- 跳过注册直接登录
- 使用过期的JWT令牌

### ✅ 正确做法
- 让系统自动生成用户名和密码，不要手动修改
- 按照文档中的测试流程顺序执行
- 查看控制台输出确认每个步骤的成功状态

## 🚨 重要提醒：动态用户名机制

### ⚠️ 关键点
1. **动态用户名生成**: 每次注册都会自动生成唯一的用户名（格式：`testuser_时间戳_随机数`）
2. **用户名和密码必须一致**: 注册时生成的用户名和密码，在登录时必须完全相同
3. **环境变量自动管理**: 注册成功后，动态用户名会自动保存到环境变量
4. **测试流程顺序**: 必须先注册，再登录，然后才能访问需要认证的接口

### 🔄 正确的测试流程
```
注册用户（自动生成用户名） → 获取用户ID → 使用相同凭据登录 → 获取JWT令牌 → 访问受保护接口
```

### ❌ 常见错误
- 手动修改用户名导致注册和登录不一致
- 跳过注册直接登录
- 使用过期的JWT令牌

### ✅ 正确做法
- 让系统自动生成用户名，不要手动修改
- 按照文档中的测试流程顺序执行
- 查看控制台输出确认每个步骤的成功状态

## 🚨 重要提醒：注册和登录的关联性

### ⚠️ 关键点
1. **用户名和密码必须一致**: 注册时使用的用户名和密码，在登录时必须完全相同
2. **环境变量自动管理**: 注册成功后，用户名和邮箱会自动保存到环境变量
3. **测试流程顺序**: 必须先注册，再登录，然后才能访问需要认证的接口

### 🔄 正确的测试流程
```
注册用户 → 获取用户ID → 使用相同凭据登录 → 获取JWT令牌 → 访问受保护接口
```

### ❌ 常见错误
- 注册时使用 `testuser`，登录时使用 `testuser2`
- 注册时密码是 `password123`，登录时密码是 `password456`
- 跳过注册直接尝试登录

### ✅ 正确做法
- 注册和登录使用完全相同的用户名和密码
- 按照文档中的测试流程顺序执行
- 查看控制台输出确认每个步骤的成功状态

### 🔐 认证流程说明

#### JWT令牌的使用
所有需要认证的接口都使用相同的JWT令牌：
- **创建文章**: `Authorization: Bearer {{jwt_token}}`
- **更新文章**: `Authorization: Bearer {{jwt_token}}`
- **删除文章**: `Authorization: Bearer {{jwt_token}}`
- **创建评论**: `Authorization: Bearer {{jwt_token}}`

#### 环境变量依赖关系
```
用户注册 → 保存用户ID
用户登录 → 保存JWT令牌 + 用户ID
创建文章 → 使用JWT令牌 → 保存文章ID
创建评论 → 使用JWT令牌 + 文章ID → 保存评论ID
```

#### 错误处理
- **401认证失败**: JWT令牌无效或过期，需要重新登录
- **403权限不足**: 用户无权限执行操作（如非作者更新文章）
- **404资源不存在**: 文章或评论不存在

## 🚀 完整测试流程

### 步骤1: 用户注册
1. 选择"用户认证" → "用户注册"
2. **重要**: 系统会自动生成随机用户名、密码和邮箱，无需手动修改
3. 确认请求体中的用户信息（系统自动生成）：
   ```json
   {
     "username": "testuser_1734567890123_456",
     "password": "a7b9c2d1",
     "email": "test_1734567890123_456@example.com"
   }
   ```
4. 点击"Send"按钮
5. 检查响应状态码是否为201
6. 验证用户ID已自动保存到环境变量
7. **重要**: 用户名和密码已保存到全局变量，登录时会自动使用

**预期结果**:
```json
{
  "code": 201,
  "message": "用户注册成功",
  "data": {
    "user_id": 1,
    "username": "testuser_1734567890123_456",
    "email": "test_1734567890123_456@example.com"
  }
}
```

**控制台输出**:
```
🔍 [Pre-request] 开始执行注册Pre-request Script
🔍 [Pre-request] 生成的动态用户名: testuser_1734567890123_456
🔍 [Pre-request] 生成的动态密码: a7b9c2d1
🔍 [Pre-request] 生成的动态邮箱: test_1734567890123_456@example.com
🔍 [Pre-request] 全局环境变量已设置
🔄 生成动态用户名: testuser_1734567890123_456
🔑 生成动态密码: a7b9c2d1
📧 生成动态邮箱: test_1734567890123_456@example.com
✅ 用户注册成功
📝 用户名: testuser_1734567890123_456
📧 邮箱: test_1734567890123_456@example.com
🆔 用户ID: 1
🔑 全局密码: a7b9c2d1
💡 提示: 现在可以使用相同的用户名和密码进行登录测试
💡 提示: 全局变量已更新，可在所有环境中使用
```

### 步骤2: 用户登录
1. 选择"用户认证" → "用户登录"
2. **重要**: 系统会自动使用全局变量中的用户名和密码
3. 确认请求体中的登录信息（系统自动使用全局变量）：
   ```json
   {
     "username": "testuser_1734567890123_456",
     "password": "a7b9c2d1"
   }
   ```
4. 点击"Send"按钮
5. 检查响应状态码是否为200
6. 验证JWT令牌已自动保存到环境变量
7. **重要**: 确保使用与注册时相同的用户名和密码

**预期结果**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_id": 1,
    "username": "testuser_1734567890123_456",
    "email": "test_1734567890123_456@example.com"
  }
}
```

**控制台输出**:
```
🔍 [Pre-request] 开始执行登录Pre-request Script
🔍 [Pre-request] 获取到的全局用户名: testuser_1734567890123_456
🔍 [Pre-request] 获取到的全局密码: a7b9c2d1
✅ [Pre-request] 使用全局用户名: testuser_1734567890123_456
✅ [Pre-request] 使用全局密码: a7b9c2d1
💡 [Pre-request] 提示: 将使用注册时生成的用户名和密码进行登录
🔄 [Pre-request] 已更新请求体用户名: testuser_1734567890123_456
🔄 [Pre-request] 已更新请求体密码: a7b9c2d1
✅ 用户登录成功
🔑 JWT令牌已保存
👤 登录用户: testuser_1734567890123_456
🆔 用户ID: 1
💡 提示: 现在可以使用JWT令牌访问需要认证的接口
```

### 步骤3: 创建文章
1. 选择"文章管理" → "创建文章"
2. 确认请求头中包含Authorization: `Bearer {{jwt_token}}`
3. 修改请求体中的文章内容：
   ```json
   {
     "title": "我的第一篇文章",
     "content": "这是文章的内容，包含详细的描述信息。",
     "summary": "文章摘要"
   }
   ```
4. 点击"Send"按钮
5. 检查响应状态码是否为201
6. 验证文章ID已自动保存到环境变量
7. **重要**: 确保JWT令牌有效，如果认证失败需要重新登录

**预期结果**:
```json
{
  "code": 201,
  "message": "文章创建成功",
  "data": {
    "id": 1,
    "title": "我的第一篇文章",
    "content": "这是文章的内容，包含详细的描述信息。",
    "summary": "文章摘要",
    "author_id": 1,
    "created_at": "2024-10-21T10:00:00Z",
    "updated_at": "2024-10-21T10:00:00Z"
  }
}
```

**控制台输出**:
```
✅ JWT令牌已找到: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
✅ 文章创建成功
📝 文章标题: 我的第一篇文章
🆔 文章ID: 1
👤 作者ID: 1
💡 提示: 现在可以使用文章ID进行评论测试
```

### 步骤4: 获取文章列表
1. 选择"文章管理" → "获取所有文章"
2. 点击"Send"按钮
3. 检查响应状态码是否为200
4. 验证返回的文章列表

**预期结果**:
```json
{
  "code": 200,
  "message": "获取文章列表成功",
  "data": [
    {
      "id": 1,
      "title": "我的第一篇文章",
      "content": "这是文章的内容，包含详细的描述信息。",
      "summary": "文章摘要",
      "author_id": 1,
      "author": {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com"
      },
      "created_at": "2024-10-21T10:00:00Z",
      "updated_at": "2024-10-21T10:00:00Z"
    }
  ]
}
```

### 步骤5: 创建评论
1. 选择"评论功能" → "创建评论"
2. 确认请求头中包含Authorization: `Bearer {{jwt_token}}`
3. 修改请求体中的评论内容：
   ```json
   {
     "content": "这是一条测试评论"
   }
   ```
4. 点击"Send"按钮
5. 检查响应状态码是否为201
6. 验证评论ID已自动保存到环境变量
7. **重要**: 确保JWT令牌和文章ID都存在

**预期结果**:
```json
{
  "code": 201,
  "message": "评论创建成功",
  "data": {
    "id": 1,
    "content": "这是一条测试评论",
    "post_id": 1,
    "author_id": 1,
    "created_at": "2024-10-21T10:00:00Z",
    "updated_at": "2024-10-21T10:00:00Z"
  }
}
```

**控制台输出**:
```
✅ JWT令牌已找到: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
✅ 文章ID已找到: 1
✅ 评论创建成功
💬 评论内容: 这是一条测试评论
🆔 评论ID: 1
📝 关联文章ID: 1
👤 评论作者ID: 1
```

### 步骤6: 获取文章评论
1. 选择"评论功能" → "获取文章评论"
2. 点击"Send"按钮
3. 检查响应状态码是否为200
4. 验证返回的评论列表

**预期结果**:
```json
{
  "code": 200,
  "message": "获取评论列表成功",
  "data": [
    {
      "id": 1,
      "content": "这是一条测试评论",
      "post_id": 1,
      "author_id": 1,
      "author": {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com"
      },
      "created_at": "2024-10-21T10:00:00Z",
      "updated_at": "2024-10-21T10:00:00Z"
    }
  ]
}
```

## 🧪 错误处理测试

### 测试1: 重复用户注册
1. 选择"错误处理测试" → "重复用户注册"
2. 点击"Send"按钮
3. 检查响应状态码是否为409
4. 验证错误消息

**预期结果**:
```json
{
  "code": 409,
  "message": "用户名或邮箱已存在"
}
```

### 测试2: 无效登录
1. 选择"错误处理测试" → "无效登录"
2. 点击"Send"按钮
3. 检查响应状态码是否为401
4. 验证错误消息

**预期结果**:
```json
{
  "code": 401,
  "message": "用户名或密码错误"
}
```

### 测试3: 无认证创建文章
1. 选择"错误处理测试" → "无认证创建文章"
2. 点击"Send"按钮
3. 检查响应状态码是否为401
4. 验证错误消息

**预期结果**:
```json
{
  "code": 401,
  "message": "未提供认证令牌"
}
```

### 测试4: 获取不存在的文章
1. 选择"错误处理测试" → "获取不存在的文章"
2. 点击"Send"按钮
3. 检查响应状态码是否为404
4. 验证错误消息

**预期结果**:
```json
{
  "code": 404,
  "message": "文章不存在"
}
```

### 测试5: 获取不存在文章的评论
1. 选择"错误处理测试" → "获取不存在文章的评论"
2. 点击"Send"按钮
3. 检查响应状态码是否为404
4. 验证错误消息

**预期结果**:
```json
{
  "code": 404,
  "message": "文章不存在"
}
```

## 🔧 环境变量检查

在测试过程中，可以通过以下方式检查环境变量：

1. 点击Postman右上角的环境选择器
2. 选择"博客系统环境"
3. 查看当前环境变量值：
   - `base_url`: http://localhost:8088
   - `jwt_token`: (登录后自动设置)
   - `user_id`: (注册/登录后自动设置)
   - `post_id`: (创建文章后自动设置)
   - `comment_id`: (创建评论后自动设置)

## 📊 测试报告

### 成功测试指标
- ✅ 用户注册成功 (201)
- ✅ 用户登录成功 (200)
- ✅ 文章创建成功 (201)
- ✅ 文章列表获取成功 (200)
- ✅ 评论创建成功 (201)
- ✅ 评论列表获取成功 (200)

### 错误处理测试指标
- ✅ 重复注册返回409
- ✅ 无效登录返回401
- ✅ 无认证操作返回401
- ✅ 资源不存在返回404
- ✅ 权限不足返回403

## 🚨 注意事项

1. **测试顺序**: 建议按照上述步骤顺序进行测试
2. **环境变量**: 确保环境变量正确设置
3. **服务器状态**: 确保博客系统服务器正常运行
4. **数据库连接**: 确保MySQL数据库服务正常
5. **JWT令牌**: 令牌有时效性，过期后需要重新登录

## 🔍 故障排除

### 常见问题及解决方案

1. **连接失败**
   - 检查服务器是否启动
   - 确认端口号8088是否正确
   - 检查防火墙设置

2. **认证失败**
   - 检查JWT令牌是否有效
   - 确认令牌格式是否正确
   - 重新登录获取新令牌

3. **环境变量未生效**
   - 确认已选择正确的环境
   - 检查变量名是否正确
   - 重新导入环境配置

4. **测试脚本未执行**
   - 检查测试脚本语法
   - 确认脚本在正确的事件中
   - 查看控制台输出

---

**最后更新**: 2024年10月21日  
**版本**: 1.0.0
