[0;35m========================================[0m
[0;35m评论功能测试[0m
[0;35m========================================[0m
测试时间: Tue Oct 21 21:10:53 CST 2025
测试URL: http://localhost:8088/api
测试用户: commenttest_1761052253

[1;33m设置测试环境...[0m
注册响应: {"code":201,"message":"用户注册成功","data":{"email":"commenttest_1761052253@example.com","user_id":32,"username":"commenttest_1761052253"}}
登录响应: {"code":200,"message":"登录成功","data":{"email":"commenttest_1761052253@example.com","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjozMiwidXNlcm5hbWUiOiJjb21tZW50dGVzdF8xNzYxMDUyMjUzIiwiZXhwIjoxNzYxMTM4NjUzLCJpYXQiOjE3NjEwNTIyNTN9.9JsleFGlDLghwIuq58WLXjT0BJKSkSe0BZOJgF48b2k","user_id":32,"username":"commenttest_1761052253"}}
[0;32m✓ 用户设置成功，获取到JWT token[0m
JWT Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkI...
[1;33m创建测试文章...[0m
创建文章响应: {"code":201,"message":"文章创建成功","data":{"id":34,"title":"评论测试文章","content":"这是一篇用于测试评论功能的文章。","summary":"","status":"published","user_id":32,"created_at":"2025-10-21T21:10:53.814+08:00","updated_at":"2025-10-21T21:10:53.814+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"}}}
[0;32m✓ 测试文章创建成功，文章ID: 34[0m

[0;34m=== 步骤 1: 评论创建功能测试 ===[0m
[1;33m执行测试: 已认证用户创建评论[0m
响应状态码: 201
响应内容: {"code":201,"message":"评论创建成功","data":{"id":58,"content":"这是一条测试评论，用于验证评论创建功能。","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:53.94+08:00","updated_at":"2025-10-21T21:10:53.94+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}}
[0;32m✓ 已认证用户创建评论: 通过[0m
[0;36m详情: 成功创建评论[0m

创建的评论ID: 58
32
0
0
[1;33m执行测试: 未认证用户创建评论[0m
请求: POST /posts/34/comments
响应状态码: 401
响应内容: {"code":401,"message":"缺少认证令牌"}
[0;32m✓ 未认证用户创建评论: 通过[0m
[0;36m详情: 状态码匹配: 401[0m

[1;33m执行测试: 无效数据创建评论[0m
请求: POST /posts/34/comments
响应状态码: 400
响应内容: {"code":400,"message":"请求参数错误: Key: 'CommentRequest.Content' Error:Field validation for 'Content' failed on the 'required' tag"}
[0;32m✓ 无效数据创建评论: 通过[0m
[0;36m详情: 状态码匹配: 400[0m

[1;33m执行测试: 缺少内容字段创建评论[0m
请求: POST /posts/34/comments
响应状态码: 400
响应内容: {"code":400,"message":"请求参数错误: Key: 'CommentRequest.Content' Error:Field validation for 'Content' failed on the 'required' tag"}
[0;32m✓ 缺少内容字段创建评论: 通过[0m
[0;36m详情: 状态码匹配: 400[0m

[1;33m执行测试: 对不存在的文章创建评论[0m
请求: POST /posts/99999/comments
响应状态码: 404
响应内容: {"code":404,"message":"文章不存在"}
[0;32m✓ 对不存在的文章创建评论: 通过[0m
[0;36m详情: 状态码匹配: 404[0m


[0;34m=== 步骤 2: 评论读取功能测试 ===[0m
[1;33m执行测试: 获取文章的所有评论列表[0m
请求: GET /posts/34/comments
响应状态码: 200
响应内容: {"code":200,"message":"获取评论列表成功","data":[{"id":58,"content":"这是一条测试评论，用于验证评论创建功能。","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:53.94+08:00","updated_at":"2025-10-21T21:10:53.94+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}]}
[0;32m✓ 获取文章的所有评论列表: 通过[0m
[0;36m详情: 状态码匹配: 200[0m

[1;33m执行测试: 获取不存在文章的评论列表[0m
请求: GET /posts/99999/comments
响应状态码: 404
响应内容: {"code":404,"message":"文章不存在"}
[0;32m✓ 获取不存在文章的评论列表: 通过[0m
[0;36m详情: 状态码匹配: 404[0m

[1;33m执行测试: 验证评论内容[0m
文章评论列表: {"code":200,"message":"获取评论列表成功","data":[{"id":58,"content":"这是一条测试评论，用于验证评论创建功能。","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:53.94+08:00","updated_at":"2025-10-21T21:10:53.94+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}]}
[0;32m✓ 验证评论内容: 通过[0m
[0;36m详情: 评论内容正确显示[0m


[0;34m=== 步骤 3: 多用户评论测试 ===[0m
[1;33m创建第二个用户进行多用户评论测试...[0m
第二个用户注册响应: {"code":201,"message":"用户注册成功","data":{"email":"commenttest2_1761052254@example.com","user_id":33,"username":"commenttest2_1761052254"}}
第二个用户登录响应: {"code":200,"message":"登录成功","data":{"email":"commenttest2_1761052254@example.com","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjozMywidXNlcm5hbWUiOiJjb21tZW50dGVzdDJfMTc2MTA1MjI1NCIsImV4cCI6MTc2MTEzODY1NSwiaWF0IjoxNzYxMDUyMjU1fQ.IJW_kmUC92xcekyTAZMHX-Kulm99owi7GnXOb_mHj0I","user_id":33,"username":"commenttest2_1761052254"}}
[0;32m✓ 第二个用户设置成功[0m
[1;33m第二个用户创建评论...[0m
第二个用户创建评论响应: {"code":201,"message":"评论创建成功","data":{"id":59,"content":"这是第二个用户创建的评论。","user_id":33,"post_id":34,"created_at":"2025-10-21T21:10:55.148+08:00","updated_at":"2025-10-21T21:10:55.148+08:00","user":{"id":33,"username":"commenttest2_1761052254","email":"commenttest2_1761052254@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:54.858+08:00","updated_at":"2025-10-21T21:10:54.858+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}}
[0;32m✓ 第二个用户创建评论: 通过[0m
[0;36m详情: 第二个用户成功创建评论[0m

[1;33m验证多用户评论...[0m
所有评论: {"code":200,"message":"获取评论列表成功","data":[{"id":58,"content":"这是一条测试评论，用于验证评论创建功能。","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:53.94+08:00","updated_at":"2025-10-21T21:10:53.94+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}},{"id":59,"content":"这是第二个用户创建的评论。","user_id":33,"post_id":34,"created_at":"2025-10-21T21:10:55.148+08:00","updated_at":"2025-10-21T21:10:55.148+08:00","user":{"id":33,"username":"commenttest2_1761052254","email":"commenttest2_1761052254@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:54.858+08:00","updated_at":"2025-10-21T21:10:54.858+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}]}
评论数量:        8
[0;32m✓ 验证多用户评论: 通过[0m
[0;36m详情: 多个用户的评论都正确显示[0m


[0;34m=== 步骤 4: 评论数据验证测试 ===[0m
[1;33m执行测试: 长评论测试[0m
长评论响应状态码: 201
长评论响应内容: {"code":201,"message":"评论创建成功","data":{"id":60,"content":"这是一条很长的评论，用于测试系统对长评论的处理能力。AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:55.468+08:00","updated_at":"2025-10-21T21:10:55.468+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}}
[0;32m✓ 长评论测试: 通过[0m
[0;36m详情: 系统正确处理长评论[0m

[1;33m执行测试: 特殊字符评论测试[0m
特殊字符评论响应状态码: 201
特殊字符评论响应内容: {"code":201,"message":"评论创建成功","data":{"id":61,"content":"这是一条包含特殊字符的评论：!@#$%^\u0026*()_+-=[]{}|;':\",./\u003c\u003e?~","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:55.607+08:00","updated_at":"2025-10-21T21:10:55.607+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}}
[0;32m✓ 特殊字符评论测试: 通过[0m
[0;36m详情: 系统正确处理特殊字符评论[0m

[1;33m执行测试: 中文评论测试[0m
中文评论响应状态码: 201
中文评论响应内容: {"code":201,"message":"评论创建成功","data":{"id":62,"content":"这是一条中文评论，测试系统对中文字符的支持。包含标点符号：，。！？；：","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:55.769+08:00","updated_at":"2025-10-21T21:10:55.769+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}}
[0;32m✓ 中文评论测试: 通过[0m
[0;36m详情: 系统正确处理中文评论[0m


[0;34m=== 步骤 5: 评论关联关系测试 ===[0m
[1;33m执行测试: 验证评论与用户的关联[0m
包含用户信息的评论列表: {"code":200,"message":"获取评论列表成功","data":[{"id":58,"content":"这是一条测试评论，用于验证评论创建功能。","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:53.94+08:00","updated_at":"2025-10-21T21:10:53.94+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}},{"id":59,"content":"这是第二个用户创建的评论。","user_id":33,"post_id":34,"created_at":"2025-10-21T21:10:55.148+08:00","updated_at":"2025-10-21T21:10:55.148+08:00","user":{"id":33,"username":"commenttest2_1761052254","email":"commenttest2_1761052254@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:54.858+08:00","updated_at":"2025-10-21T21:10:54.858+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}},{"id":60,"content":"这是一条很长的评论，用于测试系统对长评论的处理能力。AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:55.468+08:00","updated_at":"2025-10-21T21:10:55.468+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}},{"id":61,"content":"这是一条包含特殊字符的评论：!@#$%^\u0026*()_+-=[]{}|;':\",./\u003c\u003e?~","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:55.607+08:00","updated_at":"2025-10-21T21:10:55.607+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}},{"id":62,"content":"这是一条中文评论，测试系统对中文字符的支持。包含标点符号：，。！？；：","user_id":32,"post_id":34,"created_at":"2025-10-21T21:10:55.769+08:00","updated_at":"2025-10-21T21:10:55.769+08:00","user":{"id":32,"username":"commenttest_1761052253","email":"commenttest_1761052253@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:10:53.642+08:00","updated_at":"2025-10-21T21:10:53.642+08:00"},"post":{"id":0,"title":"","content":"","summary":"","status":"","user_id":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z","user":{"id":0,"username":"","email":"","nickname":"","avatar":"","bio":"","is_active":false,"post_count":0,"created_at":"0001-01-01T00:00:00Z","updated_at":"0001-01-01T00:00:00Z"}}}]}
[0;32m✓ 验证评论与用户的关联: 通过[0m
[0;36m详情: 评论正确关联用户信息[0m

[1;33m执行测试: 验证评论与文章的关联[0m
[0;32m✓ 验证评论与文章的关联: 通过[0m
[0;36m详情: 评论正确关联文章ID[0m


[0;34m=== 步骤 6: 边界条件测试 ===[0m
[1;33m执行测试: 空文章评论测试[0m
[0;32m✓ 空文章评论测试: 通过[0m
[0;36m详情: 文章有评论，数量:       20[0m

[1;33m执行测试: 大量评论测试[0m
创建多条评论...
批量评论 1 创建成功
批量评论 2 创建成功
批量评论 3 创建成功
批量评论 4 创建成功
批量评论 5 创建成功
最终评论数量:       40
[0;32m✓ 大量评论测试: 通过[0m
[0;36m详情: 系统正确处理大量评论，数量:       40[0m


[0;35m========================================[0m
[0;35m评论功能测试总结[0m
[0;35m========================================[0m
总测试数: 17
通过: [0;32m17[0m
失败: [0;31m0[0m

[0;32m🎉 所有测试通过！评论功能正常[0m
