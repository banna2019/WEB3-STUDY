[0;35m========================================[0m
[0;35m用户认证与授权功能测试[0m
[0;35m========================================[0m
测试时间: Tue Oct 21 21:09:46 CST 2025
测试URL: http://localhost:8088/api
测试用户: testuser_1761052186

[0;34m=== 步骤 1: 用户注册功能测试 ===[0m
[1;33m执行测试: 用户正常注册[0m
请求: POST /register
响应状态码: 201
响应内容: {"code":201,"message":"用户注册成功","data":{"email":"testuser_1761052186@example.com","user_id":29,"username":"testuser_1761052186"}}
[0;32m✓ 用户正常注册: 通过[0m
[0;36m详情: 状态码匹配: 201[0m

[1;33m执行测试: 重复用户名注册[0m
请求: POST /register
响应状态码: 400
响应内容: {"code":400,"message":"用户名已存在"}
[0;32m✓ 重复用户名注册: 通过[0m
[0;36m详情: 状态码匹配: 400[0m

[1;33m执行测试: 重复邮箱注册[0m
请求: POST /register
响应状态码: 400
响应内容: {"code":400,"message":"邮箱已存在"}
[0;32m✓ 重复邮箱注册: 通过[0m
[0;36m详情: 状态码匹配: 400[0m

[1;33m执行测试: 无效数据注册[0m
请求: POST /register
响应状态码: 400
响应内容: {"code":400,"message":"请求参数错误: Key: 'RegisterRequest.Username' Error:Field validation for 'Username' failed on the 'required' tag\nKey: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag\nKey: 'RegisterRequest.Email' Error:Field validation for 'Email' failed on the 'required' tag"}
[0;32m✓ 无效数据注册: 通过[0m
[0;36m详情: 状态码匹配: 400[0m


[0;34m=== 步骤 2: 用户登录功能测试 ===[0m
[1;33m执行测试: 用户正常登录[0m
登录响应: {"code":200,"message":"登录成功","data":{"email":"testuser_1761052186@example.com","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoyOSwidXNlcm5hbWUiOiJ0ZXN0dXNlcl8xNzYxMDUyMTg2IiwiZXhwIjoxNzYxMTM4NTg3LCJpYXQiOjE3NjEwNTIxODd9.cWA0fVNweju6bU50_L0qoDton1cYg6pP7L49XDCX3_c","user_id":29,"username":"testuser_1761052186"}}
[0;32m✓ 用户正常登录: 通过[0m
[0;36m详情: 成功获取JWT token[0m

JWT Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkI...
[1;33m执行测试: 错误用户名登录[0m
请求: POST /login
响应状态码: 401
响应内容: {"code":401,"message":"用户名或密码错误"}
[0;32m✓ 错误用户名登录: 通过[0m
[0;36m详情: 状态码匹配: 401[0m

[1;33m执行测试: 错误密码登录[0m
请求: POST /login
响应状态码: 401
响应内容: {"code":401,"message":"用户名或密码错误"}
[0;32m✓ 错误密码登录: 通过[0m
[0;36m详情: 状态码匹配: 401[0m

[1;33m执行测试: 无效数据登录[0m
请求: POST /login
响应状态码: 400
响应内容: {"code":400,"message":"请求参数错误: Key: 'LoginRequest.Username' Error:Field validation for 'Username' failed on the 'required' tag\nKey: 'LoginRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag"}
[0;32m✓ 无效数据登录: 通过[0m
[0;36m详情: 状态码匹配: 400[0m


[0;34m=== 步骤 3: JWT认证功能测试 ===[0m
[1;33m执行测试: 有效JWT访问受保护接口[0m
响应状态码: 201
响应内容: {"code":201,"message":"文章创建成功","data":{"id":31,"title":"测试文章","content":"这是一篇测试文章","summary":"","status":"published","user_id":29,"created_at":"2025-10-21T21:09:47.524+08:00","updated_at":"2025-10-21T21:09:47.524+08:00","user":{"id":29,"username":"testuser_1761052186","email":"testuser_1761052186@example.com","nickname":"","avatar":"","bio":"","is_active":true,"post_count":0,"created_at":"2025-10-21T21:09:46.935+08:00","updated_at":"2025-10-21T21:09:46.935+08:00"}}}
[0;32m✓ 有效JWT访问受保护接口: 通过[0m
[0;36m详情: 成功创建文章[0m

[1;33m执行测试: 无效JWT访问受保护接口[0m
响应状态码: 401
响应内容: {"code":401,"message":"无效的认证令牌"}
[0;32m✓ 无效JWT访问受保护接口: 通过[0m
[0;36m详情: 正确拒绝无效token[0m

[1;33m执行测试: 无JWT访问受保护接口[0m
响应状态码: 401
响应内容: {"code":401,"message":"缺少认证令牌"}
[0;32m✓ 无JWT访问受保护接口: 通过[0m
[0;36m详情: 正确拒绝无认证请求[0m


[0;34m=== 步骤 4: 密码加密存储验证 ===[0m
[1;33m执行测试: 密码加密存储验证[0m
注意: 此测试需要直接查询数据库验证密码是否加密存储
建议手动检查数据库中用户密码是否为加密后的哈希值
[0;31m✗ 密码加密存储验证: 失败[0m
[0;36m详情: 需要手动验证数据库中的密码字段[0m


[0;35m========================================[0m
[0;35m用户认证与授权测试总结[0m
[0;35m========================================[0m
总测试数: 12
通过: [0;32m11[0m
失败: [0;31m1[0m

[0;31m❌ 有 1 个测试失败，需要检查相关功能[0m
